@model ALFINapp.Models.DetalleTipificarClienteDTO

@{
    var numerosCreadosPorElUsuario = ViewData["numerosCreadosPorElUsuario"];
    var dni = ViewData["DNIcliente"];
    var id_asignacion = ViewData["ID_asignacion"];
    var id_base = Model.IdBase;
    var id_cliente = ViewData["ID_cliente"];

}

@section Styles {
    <link rel="stylesheet" href="~/css/main_page.css">
    <link rel="stylesheet" href="~/css/tipificar_page.css">
}

@functions {
    public string GetColorCode(string colorName)
    {
        return colorName.ToLower() switch
        {
            "verde" => "#008000",
            "amarillo" => "#FFFF00",
            "naranja" => "#FFA500",
            "rojo" => "#FF0000",
            "verde claro" => "#90EE90",
            "verde oscuro" => "#006400",
            "amarillo claro" => "#FFFFE0",
            "amarillo oscuro" => "#FFD700",
            "naranja claro" => "#FFDAB9",
            "naranja oscuro" => "#FF8C00",
            "rojo claro" => "#FF7F7F",
            "rojo oscuro" => "#8B0000",
            _ => "#FFFFFF"
        };
    }
}

<div class="row">
    <!-- Primera Columna -->
    <div class="col-md-6">
        <h3>Datos del Prospecto</h3>
        <div class="form-group">
            <label for="DNI">DNI</label>
            <input class="form-control" id="DNI" type="text" value="@dni" readonly>
        </div>
        <div class="form-group">
            <label for="X_APPATERNO">Apellido Paterno</label>
            <input class="form-control" id="X_APPATERNO" type="text" value="@Model.XAppaterno" readonly>
        </div>
        <div class="form-group">
            <label for="X_APMATERNO">Apellido Materno</label>
            <input class="form-control" id="X_APMATERNO" type="text" value="@Model.XApmaterno" readonly>
        </div>
        <div class="form-group">
            <label for="X_NOMBRE">Nombre</label>
            <input class="form-control" id="X_NOMBRE" type="text" value="@Model.XNombre" readonly>
        </div>
        <div class="form-group">
            <label for="EDAD">Edad</label>
            <input class="form-control" id="EDAD" type="text" value="@Model.Edad" readonly>
        </div>
        <div class="form-group">
            <label for="DEPARTAMENTO">Departamento</label>
            <input class="form-control" id="DEPARTAMENTO" type="text" value="@Model.Departamento" readonly>
        </div>
        <div class="form-group">
            <label for="PROVINCIA">Provincia</label>
            <input class="form-control" id="PROVINCIA" type="text" value="@Model.Provincia" readonly>
        </div>
        <div class="form-group">
            <label for="DISTRITO">Distrito</label>
            <input class="form-control" id="DISTRITO" type="text" value="@Model.Distrito" readonly>
        </div>
        <div class="spacing"></div>
        <h3>Tendencia del Prospecto</h3>
        <div class="form-group">
            <label for="PROPENSION">Propensión</label>
            <input class="form-control" id="PROPENSION" type="text" value="@Model.Propension" readonly>
        </div>
        <div class="form-group">
            <label for="TIPO_CLIENTE">Tipo de Cliente</label>
            <input class="form-control" id="TIPO_CLIENTE" type="text" value="@Model.TipoCliente" readonly>
        </div>
        <div class="form-group">
            <label for="CLIENTE_NUEVO">Antiguedad del Cliente</label>
            <input class="form-control" id="CLIENTE_NUEVO" type="text" value="@Model.ClienteNuevo" readonly>
        </div>
        <!-- Colores -->
        <div class="form-group">
            <label for="COLOR">Color Principal</label>
            <div class="d-flex align-items-center">
                <input class="form-control ml-2" style="background-color: @GetColorCode(Model.Color); width: 10%;"
                    readonly>
                <input class="form-control ml-2" id="COLOR" type="text" value="@Model.Color" readonly>
            </div>
        </div>
        <div class="form-group">
            <label for="COLOR_FINAL">Color Final</label>
            <div class="d-flex align-items-center">
                <input class="form-control ml-2" style="background-color: @GetColorCode(Model.ColorFinal); width: 10%;"
                    readonly>
                <input class="form-control ml-2" id="COLOR_FINAL" type="text" value="@Model.ColorFinal" readonly>
            </div>
        </div>
    </div>
    <!-- Segunda Columna -->
    <div class="col-md-6">
        <h3>Detalles de la Campaña</h3>
        <input class="form-control ml-2" id="IDBASEUSUARIO" value="@Model.IdBase" hidden>
        <div class="form-group">
            <label for="CAMPAÑA">Campaña</label>
            <input class="form-control" id="CAMPAÑA" type="text" value="@Model.Campaña" readonly>
        </div>
        <div class="form-group">
            <label for="OFERTA_MAX">Oferta Máxima</label>
            <input class="form-control" id="OFERTA_MAX" type="text" value="@Model.OfertaMax" readonly>
        </div>
        <div class="form-group">
            <label for="TASA_MINIMA">Tasa Mínima</label>
            <input class="form-control" id="TASA_MINIMA" type="text" value="@Model.TasaMinima" readonly>
        </div>
        <div class="form-group">
            <label for="SUCURSAL_COMERCIAL">Sucursal Comercial</label>
            <input class="form-control" id="SUCURSAL_COMERCIAL" type="text"
                value="@Model.Sucursal --> @Model.AgenciaComercial" readonly>
        </div>
        <div class="form-group">
            <label for="PLAZO">Plazo</label>
            <input class="form-control" id="PLAZO" type="text" value="@Model.Plazo" readonly>
        </div>
        <div class="form-group">
            <label for="CUOTA">Cuota</label>
            <input class="form-control" id="CUOTA" type="text" value="@Model.Cuota" readonly>
        </div>
        <div class="form-group">
            <label for="GRUPO_TASA">Grupo Tasa</label>
            <input class="form-control" id="GRUPO_TASA" type="text" value="@Model.GrupoTasa" readonly>
        </div>
        <div class="form-group">
            <label for="GRUPO_MONTO">Grupo Monto</label>
            <input class="form-control" id="GRUPO_MONTO" type="text" value="@Model.GrupoMonto" readonly>
        </div>
        <div class="spacing"></div>

        <h2>Detalles de las Ofertas</h2>
        <!--<div class="spacing"></div>
        <form asp-action="culminarCliente" asp-controller="User">
            <input type="hidden" name="IdAsignacion" value="@id_asignacion" />
            <button class="btn btn-warning" type="submit">Culminar</button>
        </form>
        <div class="spacing"></div>
        <p>Activar este boton culminara con las tipificaciones del Cliente y sera notificado al Supervisor.
            Esta accion no puede ser revertida</p>
        -->
        <div class="spacing"></div>
        <div class="form-group">
            <label for="GRUPO_MONTO">Oferta 12 Meses</label>
            <input class="form-control" id="GRUPO_MONTO" type="text" value="@Model.Oferta12m" readonly>
        </div>
        <div class="form-group">
            <label for="GRUPO_MONTO">Tasa 12 Meses</label>
            <input class="form-control" id="GRUPO_MONTO" type="text" value="@Model.Tasa12m" readonly>
        </div>
        <div class="form-group">
            <label for="GRUPO_MONTO">Cuota 12 Meses</label>
            <input class="form-control" id="GRUPO_MONTO" type="text" value="@Model.Cuota12m" readonly>
        </div>
        <div class="spacing"></div>
        <div class="form-group">
            <label for="GRUPO_MONTO">Oferta 24 Meses</label>
            <input class="form-control" id="GRUPO_MONTO" type="text" value="@Model.Oferta24m" readonly>
        </div>
        <div class="form-group">
            <label for="GRUPO_MONTO">Tasa 24 Meses</label>
            <input class="form-control" id="GRUPO_MONTO" type="text" value="@Model.Tasa24m" readonly>
        </div>
        <div class="form-group">
            <label for="GRUPO_MONTO">Cuota 24 Meses</label>
            <input class="form-control" id="GRUPO_MONTO" type="text" value="@Model.Cuota24m" readonly>
        </div>
        <div class="spacing"></div>
        <div class="form-group">
            <label for="GRUPO_MONTO">Oferta 36 Meses</label>
            <input class="form-control" id="GRUPO_MONTO" type="text" value="@Model.Oferta36m" readonly>
        </div>
        <div class="form-group">
            <label for="GRUPO_MONTO">Tasa 36 Meses</label>
            <input class="form-control" id="GRUPO_MONTO" type="text" value="@Model.Tasa36m" readonly>
        </div>
        <div class="form-group">
            <label for="GRUPO_MONTO">Cuota 36 Meses</label>
            <input class="form-control" id="GRUPO_MONTO" type="text" value="@Model.Cuota36m" readonly>
        </div>
    </div>
</div>

<div class="spacing"></div>


<!-- SECCION TELEFONOS AGREGADOS Por El Usuario -->
<div class="row">
    <h3 class="label-fortip">Contactos Creados por el Usuario:</h3>

    @if (numerosCreadosPorElUsuario is IEnumerable<dynamic> numCreatedByUser && numCreatedByUser.Any())
    {
        int contadorNumeros = 0;
        <form asp-action="GuardarTipificacionesNumPersonales" asp-controller="User" method="post">
            <input type="hidden" name="IdAsignacionCliente" value="@ViewData["ID_asignacion"]">
            <h3>Agregue las Tipificaciones a los clientes asignados</h3>
            @foreach (var telefonosVendedor in numCreatedByUser)
            {
                <div class="form-group row align-items-center mb-3">
                    <div class="col-12 col-md-4">
                        <label for="Telefono[@contadorNumeros]" class="form-label">Teléfono @contadorNumeros</label>
                        <input class="form-control" name="tipificaciones[@contadorNumeros].Telefono"
                            id="Telefono_@contadorNumeros" type="text" value="@telefonosVendedor.TelefonoTipificado" readonly />
                        <div class="spacing"></div>
                        <textarea class="form-control" id="comentarioAsesor_@contadorNumeros"
                            data-telefono="@telefonosVendedor.TelefonoTipificado"
                            data-id-cliente="@id_cliente">@telefonosVendedor.ComentarioTelefono</textarea>
                        <div class="spacing"></div>
                        <a href="javascript:void(0);" class="btn btn-primary"
                            onclick="enviarComentario('@id_cliente', '@telefonosVendedor.TelefonoTipificado', 'comentarioAsesor_@contadorNumeros')">
                            Agregue un Comentario
                        </a>
                    </div>
                    <div class="col-12 col-md-8 mt-2 mt-md-0">

                        <!-- Select de Tipificación -->

                        <input type="hidden" name="tipificaciones[@contadorNumeros].TipificacionId"
                            id="tipificacionId_@contadorNumeros" />

                        <!-- Datalist para el filtrado -->

                        <label for="tipificacionSelect_@contadorNumeros" class="form-label mt-2">Tipificación Asignada
                            @contadorNumeros: </label>
                        <input class="form-control" list="tipificacionesList_@contadorNumeros"
                            name="tipificaciones[@contadorNumeros].TipificacionDescripcion"
                            id="tipificacionSelect_@contadorNumeros" placeholder="Presione 2 veces para ver las tipificaciones"
                            oninput="actualizarIdTipificacion(@contadorNumeros)" />

                        <datalist id="tipificacionesList_@contadorNumeros">
                            <option value="">Seleccione la descripción de Tipificación</option>
                            @foreach (var tipificacion in (IEnumerable<dynamic>)ViewData["Tipificaciones"])
                            {
                                <option value="@tipificacion.DescripcionTipificacion" data-id="@tipificacion.IdTipificacion">
                                    @tipificacion.DescripcionTipificacion</option>
                            }
                        </datalist>
                        <input class="form-control" id="GRUPO_MONTO" type="text"
                            value="@telefonosVendedor.DescripcionTipificacion" readonly />
                    </div>
                    <div class="spacing"></div>
                </div>

                contadorNumeros++; // Incrementar el contador después de cada teléfono
            }

            <div class="form-group">
                <div class="alert alert-info" role="alert">
                    Use este boton para agregar las Tipificaciones de los numeros de TELEFONOS ASIGNADOS POR USTED
                </div>
                <button class="btn btn-success" type="submit">Guardar Tipificaciones</button>
                <a href="@Url.Action("Ventas", "User")" class="btn btn-danger">Cancelar</a>
            </div>
        </form>
    }

    else
    {
        <div class="alert alert-info" role="alert">
            No tiene números de teléfonos asignados por el usuario.
        </div>
    }
    <div class="spacing"></div>
    <div class="spacing"></div>
    <div>
        <h4>Agregue numeros de Telefono Personales</h4>
        <div>
            <div id="agregarTelefonoBtnCliente">
                <a href="javascript:void(0);" class="btn btn-primary" id="agregarTelefonoBtn"
                    onclick="cargarEdicionDeTelefonos(@id_cliente)">Agregue un Nuevo Telefono</a>
            </div>
            <div id="cancelaragregarTelefonoBtnCliente" style="display: none;">
                <a href="javascript:void(0);" class="btn btn-secondary" id="cancelaragregarTelefonoBtn"
                    onclick="descargarEdicionDeTelefonos()">Cancelar</a>
            </div>
        </div>

        <div class="spacing"></div>
        <!-- Aca aparecera el FORM -->
        <div id="agregarTelefonoContainer">
        </div>
        <div class="spacing"></div>
    </div>
</div>

<!-- SECCION TELEFONOS AGREGADOS Por LA DB -->

<div class="spacing"></div>
<form asp-action="TipificarMotivo" asp-controller="User" method="post">
    <div class="row">
        <h3 class="label-fortip">Contacto con Cliente - Y Tipificaciones Asignadas:</h3>
        @{
            int contador = 1;
            string? tipificacion1 = null;
            string? tipificacion2 = null;
            string? tipificacion3 = null;
            string? tipificacion4 = null;
            string? tipificacion5 = null;
        }

        @if (ViewData["numerosTraidosPorlaDB"] is IEnumerable<dynamic> tipificaciones)
        {
            @foreach (var tipificacion in tipificaciones)
            {
                string? telefono = tipificacion.TelefonoTipificado;
                if (telefono == @Model.Telefono1) { tipificacion1 = tipificacion.DescripcionTipificacion; }
                if (telefono == @Model.Telefono2) { tipificacion2 = tipificacion.DescripcionTipificacion; }
                if (telefono == @Model.Telefono3) { tipificacion3 = tipificacion.DescripcionTipificacion; }
                if (telefono == @Model.Telefono4) { tipificacion4 = tipificacion.DescripcionTipificacion; }
                if (telefono == @Model.Telefono5) { tipificacion5 = tipificacion.DescripcionTipificacion; }
                contador++;
            }
        }
        <input type="hidden" name="IdAsignacion" value="@ViewData["ID_asignacion"]">
        <!-- Teléfono 1 -->
        <div class="form-group row align-items-center mb-3">
            <div class="col-12 col-md-4">
                <label for="Telefono1" class="form-label">Teléfono 1</label>
                <input class="form-control" name="Telefono1" id="Telefono1" type="text" value="@Model.Telefono1"
                    readonly>
            </div>

            @if (@Model.Telefono1 != "0")
            {
                <div class="col-12 col-md-8 mt-2 mt-md-0">

                    <input type="hidden" name="Tipificacion1" id="tipificacionId_db1" />

                    <label for="tipificacionSelect_db1" class="form-label mt-2">Tipificación Asignada 1: </label>

                    <input class="form-control" list="tipificacionesList_db1"
                        name="tipificacionesdb1.TipificacionDescripcion" id="tipificacionSelect_db1"
                        placeholder="Presione 2 veces para ver las tipificaciones"
                        oninput="actualizarIdTipificacion('db1')" />

                    <datalist id="tipificacionesList_db1">
                        <option value="">Seleccione la descripción de Tipificación</option>
                        @foreach (var tipificacion in (IEnumerable<dynamic>)ViewData["Tipificaciones"])
                        {
                            <option value="@tipificacion.DescripcionTipificacion" data-id="@tipificacion.IdTipificacion">
                                @tipificacion.DescripcionTipificacion</option>
                        }
                    </datalist>

                    <input class="form-control" id="GRUPO_MONTO" type="text" value="@tipificacion1" readonly>
                </div>
            }
        </div>

        <!-- Teléfono 2 -->
        <div class="form-group row align-items-center mb-3">
            <div class="col-12 col-md-4">
                <label for="Telefono2" class="form-label">Teléfono 2</label>
                <input class="form-control" name="Telefono2" id="Telefono2" type="text" value="@Model.Telefono2"
                    readonly>
            </div>
            @if (@Model.Telefono2 != "0")
            {
                <div class="col-12 col-md-8 mt-2 mt-md-0">
                    <input type="hidden" name="Tipificacion2" id="tipificacionId_db2" />

                    <label for="tipificacionSelect_db2" class="form-label mt-2">Tipificación Asignada 2: </label>

                    <input class="form-control" list="tipificacionesList_db2"
                        name="tipificacionesdb2.TipificacionDescripcion" id="tipificacionSelect_db2"
                        placeholder="Presione 2 veces para ver las tipificaciones"
                        oninput="actualizarIdTipificacion('db2')" />

                    <datalist id="tipificacionesList_db2">
                        <option value="">Seleccione la descripción de Tipificación</option>
                        @foreach (var tipificacion in (IEnumerable<dynamic>)ViewData["Tipificaciones"])
                        {
                            <option value="@tipificacion.DescripcionTipificacion" data-id="@tipificacion.IdTipificacion">
                                @tipificacion.DescripcionTipificacion</option>
                        }
                    </datalist>
                    <input class="form-control" id="GRUPO_MONTO" type="text" value="@tipificacion2" readonly>
                </div>
            }
        </div>

        <!-- Teléfono 3 -->
        <div class="form-group row align-items-center mb-3">
            <div class="col-12 col-md-4">
                <label for="Telefono3" class="form-label">Teléfono 3</label>
                <input class="form-control" name="Telefono3" id="Telefono3" type="text" value="@Model.Telefono3"
                    readonly>
            </div>

            @if (@Model.Telefono3 != "0")
            {
                <div class="col-12 col-md-8 mt-2 mt-md-0">
                    <input type="hidden" name="Tipificacion3" id="tipificacionId_db3" />

                    <label for="tipificacionSelect_db3" class="form-label mt-2">Tipificación Asignada 3: </label>
                        
                    <input class="form-control" list="tipificacionesList_db3"
                        name="tipificacionesdb3.TipificacionDescripcion"
                        id="tipificacionSelect_db3" placeholder="Presione 2 veces para ver las tipificaciones"
                        oninput="actualizarIdTipificacion('db3')" />

                    <datalist id="tipificacionesList_db3">
                        <option value="">Seleccione la descripción de Tipificación</option>
                        @foreach (var tipificacion in (IEnumerable<dynamic>)ViewData["Tipificaciones"])
                        {
                            <option value="@tipificacion.DescripcionTipificacion" data-id="@tipificacion.IdTipificacion">
                                @tipificacion.DescripcionTipificacion</option>
                        }
                    </datalist>
                    <input class="form-control" id="GRUPO_MONTO" type="text" value="@tipificacion3" readonly>
                </div>
            }
        </div>

        <div class="form-group row align-items-center mb-3">
            <div class="col-12 col-md-4">
                <label for="Telefono4" class="form-label">Teléfono 4</label>
                <input class="form-control" name="Telefono4" id="Telefono4" type="text" value="@Model.Telefono4"
                    readonly>
            </div>

            @if (@Model.Telefono4 != "0")
            {
                <div class="col-12 col-md-8 mt-2 mt-md-0">
                    <input type="hidden" name="Tipificacion4" id="tipificacionId_db4" />

                    <label for="tipificacionSelect_db4" class="form-label mt-2">Tipificación Asignada 4: </label>
                        
                    <input class="form-control" list="tipificacionesList_db4"
                        name="tipificacionesdb4.TipificacionDescripcion"
                        id="tipificacionSelect_db4" placeholder="Presione 2 veces para ver las tipificaciones"
                        oninput="actualizarIdTipificacion('db4')" />

                    <datalist id="tipificacionesList_db4">
                        <option value="">Seleccione la descripción de Tipificación</option>
                        @foreach (var tipificacion in (IEnumerable<dynamic>)ViewData["Tipificaciones"])
                        {
                            <option value="@tipificacion.DescripcionTipificacion" data-id="@tipificacion.IdTipificacion">
                                @tipificacion.DescripcionTipificacion</option>
                        }
                    </datalist>
                    <input class="form-control" id="GRUPO_MONTO" type="text" value="@tipificacion4" readonly>
                </div>
            }
        </div>

        <div class="form-group row align-items-center mb-3">
            <div class="col-12 col-md-4">
                <label for="Telefono5" class="form-label">Teléfono 5</label>
                <input class="form-control" name="Telefono5" id="Telefono5" type="text" value="@Model.Telefono5"
                    readonly>
            </div>

            @if (@Model.Telefono5 != "0")
            {
                <div class="col-12 col-md-8 mt-2 mt-md-0">
                    <input type="hidden" name="Tipificacion5" id="tipificacionId_db5" />

                    <label for="tipificacionSelect_db5" class="form-label mt-2">Tipificación Asignada 5: </label>
                        
                    <input class="form-control" list="tipificacionesList_db5"
                        name="tipificacionesdb5.TipificacionDescripcion"
                        id="tipificacionSelect_db5" placeholder="Presione 2 veces para ver las tipificaciones"
                        oninput="actualizarIdTipificacion('db5')" />

                    <datalist id="tipificacionesList_db5">
                        <option value="">Seleccione la descripción de Tipificación</option>
                        @foreach (var tipificacion in (IEnumerable<dynamic>)ViewData["Tipificaciones"])
                        {
                            <option value="@tipificacion.DescripcionTipificacion" data-id="@tipificacion.IdTipificacion">
                                @tipificacion.DescripcionTipificacion</option>
                        }
                    </datalist>
                    <input class="form-control" id="GRUPO_MONTO" type="text" value="@tipificacion5" readonly>
                </div>
            }
        </div>
    </div>

    <br>

    <div class="form-group">
        <div class="alert alert-info" role="alert">
            Use este boton para agregar las tipificaciones de los numeros de TELEFONOS ASIGNADOS POR LA EMPRESA
        </div>
        <button class="btn btn-success" type="submit">Guardar Tipificaciones</button>
        <a href="@Url.Action("Ventas", "User")" class="btn btn-danger">Cancelar</a>
    </div>
</form>


<script>
    function editarTelefono(campo) {
        // Mostrar los botones de guardar y cancelar
        document.getElementById('botonesEdicion_' + campo).style.display = 'block';

        // Ocultar el botón de "Agregar Teléfono"
        document.getElementById('agregarTelefono_' + campo).style.display = 'none';
    }

    function cancelarEdicion(campo) {
        document.getElementById(campo).value = '0';
        document.getElementById('agregarTelefono_' + campo).style.display = 'block';
        document.getElementById('botonesEdicion_' + campo).style.display = 'none';
    }

    function guardarTelefono(idasignacion, campo) {
        const userConfirmed = confirm('Advertencia: Recuerde que solo se puede tener un maximo de 5 numeros por cliente y esta insercion llenara un campo de telefono. ¿Está seguro de continuar?');
        if (userConfirmed) {
            const valorTelefono = document.getElementById(campo).value;
            const idBase = document.getElementById('IDBASEUSUARIO').value;


            if (!valorTelefono.trim()) {
                alert('El número de teléfono no puede estar vacío.');
                return;
            }

            if (!/^\d+$/.test(valorTelefono)) {
                alert('Ingrese solo números');
                return;
            }

            if (!/^\d{9}$/.test(valorTelefono)) {
                alert('El número de teléfono debe tener exactamente 9 dígitos.');
                return;
            }

            $.ajax({
                url: '/User/AgregarTelefono',
                type: 'POST',
                data: {
                    IdAsignacion: idasignacion,
                    NuevoTelefono: valorTelefono,
                    NumTelefonoEdicion: campo
                },
                success: function (result) {
                    alert('Se ha actualizado el Numero del Cliente Recargue la Pagina para verificar los cambios');
                },
                error: function () {
                    alert('Error al agregar un nuevo numero de Telefono' + errorThrown);
                }
            });
        } else {
            alert('La acción ha sido cancelada.');
        }
    }

    function loadCulminacionCliente(id_asignacion) {
        if (!id_asignacion) {
            alert('El ID de asignación no es válido.');
            return;
        }

        const userConfirmed = confirm('Advertencia: Si culmina con el cliente, esta acción no se puede revertir. ¿Está seguro de continuar?');

        if (userConfirmed) {
            $.ajax({
                url: '/User/culminarCliente',
                type: 'POST',
                data: { "IdAsignacion": id_asignacion },
                success: function (result) {
                    alert('Se ha culminado con el cliente correctamente.');
                },
                error: function (xhr, status, error) {
                    console.error('Error al culminar con el cliente:', error);
                    alert('Hubo un error al intentar culminar con el cliente. Por favor, inténtalo nuevamente.');
                }
            });
        } else {
            // Si el usuario cancela, muestra un mensaje opcional
            alert('La acción ha sido cancelada.');
        }
    }
</script>

<script>
    function cargarEdicionDeTelefonos(idcliente) {
        if (!idcliente) {
            alert('El ID del cliente no es valido.');
            return;
        }

        const userConfirmed = confirm('Agregar un nuevo telefono Notificara al Supervisor. ¿Está seguro de continuar?');
        if (userConfirmed) {
            $.ajax({
                url: '/User/AgregarTelefonoView',
                type: 'GET',
                data: { "idCliente": idcliente },
                success: function (response) {
                    document.getElementById('agregarTelefonoBtnCliente').style.display = 'none';
                    document.getElementById('cancelaragregarTelefonoBtnCliente').style.display = 'block';
                    document.getElementById('agregarTelefonoContainer').style.display = 'block';
                    $('#agregarTelefonoContainer').html(response);
                },
                error: function () {
                    alert('Hubo un error al cargar la vista.');
                }
            });
        }
    }

    function descargarEdicionDeTelefonos(idcliente) {
        document.getElementById('agregarTelefonoBtnCliente').style.display = 'block';
        document.getElementById('cancelaragregarTelefonoBtnCliente').style.display = 'none';
        document.getElementById('agregarTelefonoContainer').style.display = 'none';
    }
</script>
<script>
    function enviarComentario(idCliente, telefono, textareaId) {
        const comentario = document.getElementById(textareaId).value;

        if (!comentario) {
            alert('Por favor, ingrese un comentario antes de enviarlo.');
            return;
        }

        // Enviar la solicitud POST con los datos al controlador
        $.ajax({
            url: '/User/EnviarComentario', // Asegúrate de que coincida con la ruta del controlador
            type: 'POST', // Especificar método POST
            data: {
                Telefono: telefono,
                IdCliente: idCliente,
                Comentario: comentario
            },
            headers: {
                'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val() // Anti-CSRF
            },
            success: function (response) {
                if (response.success) {
                    alert('Comentario agregado correctamente.');
                } else {
                    alert('Error: ' + response.message);
                }
            },
            error: function (xhr, status, error) {
                console.error('Error al enviar comentario:', error);
                alert('Hubo un error inesperado al enviar el comentario.');
            }
        });
    }
</script>

<script>
    // Función para actualizar el ID de la tipificación cuando se selecciona una opción del datalist
    function actualizarIdTipificacion(contadorNumeros) {
        var inputText = document.getElementById('tipificacionSelect_' + contadorNumeros);
        var datalist = document.getElementById('tipificacionesList_' + contadorNumeros);
        var hiddenInput = document.getElementById('tipificacionId_' + contadorNumeros);

        // Buscar la opción correspondiente en el datalist
        for (var option of datalist.options) {
            if (option.value === inputText.value) {
                hiddenInput.value = option.getAttribute('data-id'); // Actualizar el ID oculto
                return;
            }
        }

        hiddenInput.value = ''; // Si no hay coincidencia, limpiar el ID
    }
</script>