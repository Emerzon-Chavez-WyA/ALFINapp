@model ALFINapp.Models.Usuario

<h2 class="label-for-sup-sec">Agregue un Nuevo Usuario:</h2>
<div class="row">
    <div class="alert alert-info">
        Llene todos los campos para poder agregar un nuevo usuario.
    </div>
    <div class="col-md-6">
        <div class="mb-3">
            <label for="dni" class="form-label">DNI</label>
            <input type="text" class="form-control" id="dni" name="dni" required oninput="validarDNI()">
            <div class="invalid-feedback" id="dni-error">
                El DNI debe tener 8 dígitos y solo números.
            </div>
        </div>
        <div class="mb-3">
            <label for="departamento" class="form-label">Departamento</label>
            <input type="text" class="form-control" id="departamento" name="departamento" required>
        </div>
        <div class="mb-3">
            <label for="provincia" class="form-label">Provincia</label>
            <input type="text" class="form-control" id="provincia" name="provincia" required>
        </div>
        <div class="mb-3">
            <label for="distrito" class="form-label">Distrito</label>
            <input type="text" class="form-control" id="distrito" name="distrito" required>
        </div>
        <div class="mb-3">
            <label for="region" class="form-label">Region</label>
            <input type="text" class="form-control" id="region" name="region" required
                oninput="validarLetras('region')">
            <div class="invalid-feedback" id="region-error">
                El campo Region solo puede tener letras.
            </div>
        </div>
        <div class="mb-3">
            <label for="rol" class="form-label">Rol</label>
            <select class="form-control" id="rol" name="rol" required>
                <option value="SUPERVISOR">SUPERVISOR</option>
                <option value="VENDEDOR">VENDEDOR</option>
            </select>
        </div>
    </div>

    <div class="col-md-6">
        <div class="mb-3">
            <label for="apellido_paterno" class="form-label">Apellido Paterno</label>
            <input type="text" class="form-control" id="apellido_paterno" name="apellido_paterno" required
                oninput="validarLetras('apellido_paterno')">
            <div class="invalid-feedback" id="apellido_paterno-error">
                El campo Apellido Paterno solo puede tener letras.
            </div>
        </div>
        <div class="mb-3">
            <label for="apellido_materno" class="form-label">Apellido Materno</label>
            <input type="text" class="form-control" id="apellido_materno" name="apellido_materno" required
                oninput="validarLetras('apellido_materno')">
            <div class="invalid-feedback" id="apellido_materno-error">
                El campo Apellido Materno solo puede tener letras.
            </div>
        </div>
        <div class="mb-3">
            <label for="nombres" class="form-label">Nombres Completos</label>
            <input type="text" class="form-control" id="nombres" name="nombres" required
                oninput="validarLetras('nombres')">
            <div class="invalid-feedback" id="nombres-error">
                El campo Nombres Completos solo puede tener letras.
            </div>
        </div>
        <div class="mb-3">
            <label for="telefono" class="form-label">Telefono</label>
            <input type="text" class="form-control" id="telefono" name="telefono" required oninput="validarTelefono()">
            <div class="invalid-feedback" id="telefono-error">
                El telefono solo puede tener números.
            </div>
        </div>


    </div>
</div>
<div class="spacing"> </div>

<div class="row">
    <div class="col-md-12">
        <a href="javascript:void(0)" class="btn btn-success" onclick="guardarNuevoAsesor()">Agregar</a>
    </div>
</div>

<script>
    function guardarNuevoAsesor() {
        // Validar todas las entradas antes de enviar
        var inputs = ['dni', 'departamento', 'provincia', 'distrito', 'region', 'rol', 'apellido_paterno', 'apellido_materno', 'nombres', 'telefono'];

        // Validar DNI
        var dni = document.getElementById('dni').value.trim();
        if (!/^[0-9]{8}$/.test(dni)) {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'El DNI debe tener 8 dígitos y solo números.'
            });
            return;
        }

        // Validar campos de solo letras
        var soloLetrasCampos = ['departamento', 'provincia', 'distrito', 'region', 'apellido_paterno', 'apellido_materno', 'nombres'];
        var valid = true;
        soloLetrasCampos.forEach(function (campo) {
            var valor = document.getElementById(campo).value.trim();

            // Validar si el campo contiene solo letras y espacios
            if (!/^[a-zA-Z\s]+$/.test(valor)) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'El campo "' + campo + '" solo puede tener letras.'
                });
                valid = false;  // Si hay error, valid se establece a false
                return;  // Detener la ejecución del loop si ya hubo un error
            }
        });

        if (!valid) {
            // Aquí puedes hacer algo si hay algún error en los campos
            console.log('Existen errores en los campos.');
        }

        // Validar teléfono
        var telefono = document.getElementById('telefono').value.trim();
        if (!/^[0-9]{9}$/.test(telefono)) {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'El campo Telefono solo puede tener valores Numericos y No puede estar Vacio'
            });
            return;
        }

        $.ajax({
            url: "/Asesor/AgregarNuevoAsesor",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                Dni: dni,
                Departamento: document.getElementById('departamento').value.trim(),
                Provincia: document.getElementById('provincia').value.trim(),
                Distrito: document.getElementById('distrito').value.trim(),
                REGION: document.getElementById('region').value.trim(),
                Rol: document.getElementById('rol').value.trim(),
                NombresCompletos: document.getElementById('nombres').value.trim() 
                    + ' ' + document.getElementById('apellido_paterno').value.trim()
                    + ' ' + document.getElementById('apellido_materno').value.trim(),
                Telefono: telefono
            }),
            success: function (response) {
                if (response.success === true) {
                    // Aquí puedes mostrar un mensaje de éxito o redirigir a otra página
                    Swal.fire({
                        icon: 'success',
                        title: 'Informacion del asesor',
                        text: response.message
                    });
                }
                else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: response.message
                    });
                }
            },
            error: function () {
                // Aquí puedes mostrar un mensaje de error
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Hubo un error al agregar el usuario.'
                });
            }
        });
    }

    function validarDNI() {
        var dni = document.getElementById('dni').value;
        var dniInput = document.getElementById('dni');
        var errorElement = document.getElementById('dni-error');
        var regex = /^[0-9]{8}$/; // Valida solo números y exactamente 8 dígitos

        if (!regex.test(dni)) {
            dniInput.classList.add('is-invalid'); // Aplica el estilo de error de Bootstrap
            errorElement.style.display = 'block'; // Muestra el mensaje de error
        } else {
            dniInput.classList.remove('is-invalid'); // Remueve el estilo de error de Bootstrap
            errorElement.style.display = 'none'; // Oculta el mensaje de error
        }
    }

    function validarTelefono() {
        var telefono = document.getElementById('telefono').value;
        var telefonoInput = document.getElementById('telefono');
        var errorElement = document.getElementById('telefono-error');
        var regex = /^[0-9]+$/; // Valida solo números

        if (!regex.test(telefono)) {
            telefonoInput.classList.add('is-invalid'); // Aplica el estilo de error de Bootstrap
            errorElement.style.display = 'block'; // Muestra el mensaje de error
        } else {
            telefonoInput.classList.remove('is-invalid'); // Remueve el estilo de error de Bootstrap
            errorElement.style.display = 'none'; // Oculta el mensaje de error
        }
    }

    function validarLetras(campo) {
        var campol = document.getElementById(campo).value;
        var campolInput = document.getElementById(campo);
        var errorElement = document.getElementById(campo + '-error');
        var regex = /^[a-zA-Z\s]+$/; // Valida solo letras y espacios

        if (!regex.test(campol)) {
            campolInput.classList.add('is-invalid'); // Aplica el estilo de error de Bootstrap
            errorElement.style.display = 'block'; // Muestra el mensaje de error
        } else {
            campolInput.classList.remove('is-invalid'); // Remueve el estilo de error de Bootstrap
            errorElement.style.display = 'none'; // Oculta el mensaje de error
        }
    }
</script>